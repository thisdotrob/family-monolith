instructions:
  - name: Fix auth token refresh logic in webapp
    description: The refresh logic is broken. When a token expires I am taken back to the LoginPage and both tokens are cleared from localstorage. When this happens these are the network requests I see in devtools - 1. `query Me` request to `/v1/graphql/app`. This has the expired token in the headers and so gets a 401 response. 2. `mutation refreshToken` request to `/v1/graphql/auth`. This includes the original refreshToken from localstorage. Response is a 200 and includes a new auth token and a new refresh token. 3. `query Me` request to `/v1/graphql/app`. This still has the expired token in the headers and so gets a 401 response. 4. `mutation refreshToken` request to `/v1/graphql/auth`. This still has the original refreshToken, not the new one received from the first `mutation refreshToken` response, and so while the response is a 200 the response body has `refreshToken.success` of false and there are no new tokens included. 5. `query Me` request to `/v1/graphql/app`. This request has the new token in the header. Sometimes the request finishes and I see the HomePage and am still logged in as expected, but most of the time this request is marked as 'cancelled' in dev tools and I see the login page and am logged out as described above.
    content_file: fix-auth-token-refresh-logic-in-webapp.md
